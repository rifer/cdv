'use strict';

//Demo of Searching and Sorting Table with AngularJS
var myApp = angular.module('myApp', [
    '720kb.tooltips'
    ]);

myApp.controller('TableCtrl', ['$scope', '$http', function ($scope, $http) {
    var url = "http://carceldeventas.net/sources/deceased.json";
    $scope.allItems = [];
    $http.get(url).
        success(function(data, status, headers, config) {
          $scope.allItems = data;
          $scope.filteredList = $scope.allItems;
        }).
        error(function(data, status, headers, config) {
          // log error
        });

    $scope.resetAll = function () {
        $scope.filteredList = $scope.allItems;
        $scope.newName = '';
        $scope.newYears = '';
        $scope.newDate = '';
        $scope.newDeath = '';
        $scope.newDeathtype = '';
        $scope.newFiles = '';
        $scope.newNotes = '';
        $scope.searchText = '';
    }

    $scope.search = function () {
        $scope.filteredList = _.filter($scope.allItems,

        function (item) {
            return searchUtil(item, $scope.searchText);
        });

        if ($scope.searchText == '') {
            $scope.filteredList = $scope.allItems;
        }
    }

    $scope.resetAll();
}]);


function searchUtil(item, toSearch) {

    return (
            item.date.toLowerCase().indexOf(toSearch.toLowerCase()) > -1 || 
            item.name.toLowerCase().indexOf(toSearch.toLowerCase()) > -1 || 
            item.years.toLowerCase().indexOf(toSearch.toLowerCase()) > -1 ||
            item.files.toLowerCase().indexOf(toSearch.toLowerCase()) > -1 || 
            item.deathtype.toLowerCase().indexOf(toSearch.toLowerCase()) > -1 ) ? true : false;

}


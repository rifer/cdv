'use strict';

var myApp = angular.module('myApp', [
    'ngStorage',
    '720kb.tooltips'
    ]);

myApp.controller('TableCtrl', ['$scope', '$http', '$localStorage', function ($scope, $http, $localStorage) {
    var url = "http://carceldeventas.net/sources/deceased.json";
    $scope.allItems = [];
    if ($localStorage.list != undefined) {
        $scope.allItems = $localStorage.list;
        $scope.filteredList = $scope.allItems;
    }
    else {
        $http.get(url).
        success(function(data, status, headers, config) {
            $scope.allItems = data;
            $scope.filteredList = $scope.allItems;
            $localStorage.list = $scope.allItems;
        }).
        error(function(data, status, headers, config) {
          // log error
        });
    };


    $scope.search = function () {
        $scope.filteredList = _.filter($scope.allItems,
        function (item) {
            return searchUtil(item, $scope.searchText);
        });

        if ($scope.searchText == '') {
            $scope.filteredList = $scope.allItems;
        }
    }
}]);

function searchUtil(item, toSearch) {
    return (
        item.date.toLowerCase().indexOf(toSearch.toLowerCase()) > -1 ||
        item.death.toLowerCase().indexOf(toSearch.toLowerCase()) > -1 || 
        item.name.toLowerCase().indexOf(toSearch.toLowerCase()) > -1 || 
        item.years.toLowerCase().indexOf(toSearch.toLowerCase()) > -1 ||
        item.files.toLowerCase().indexOf(toSearch.toLowerCase()) > -1 || 
        item.deathtype.toLowerCase().indexOf(toSearch.toLowerCase()) > -1 ) 
        ? true : false;
}


